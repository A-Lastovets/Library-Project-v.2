<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Live –ß–µ—Ä–≥–∞ –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ä—ñ–≤</title>
</head>
<body>
  <h2>üì° Live Queue /ws/queue</h2>
  <pre id="log" style="background:#f4f4f4; padding:10px; height:300px; overflow:auto;"></pre>

  <script>
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }

    const token = getCookie("access_token");

    if (!token) {
      alert("‚ùå –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ access_token. –£–≤—ñ–π–¥—ñ—Ç—å —è–∫ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ä.");
    } else {
      const ws = new WebSocket("ws://localhost:8000/ws/queue");

      ws.onopen = function () {
        document.getElementById("log").innerText += "‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —á–µ—Ä–≥–∏...\n";
      };

      ws.onmessage = function (event) {
        const data = JSON.parse(event.data);
        const log = document.getElementById("log");

        if (data.event === "new_chat") {
          const chat = data.data;
          log.innerText += `üÜï –ù–æ–≤–∏–π —á–∞—Ç:\n`;
          log.innerText += `- ID —Å–µ—Å—ñ—ó: ${chat.session_id}\n`;
          log.innerText += `- Reader ID: ${chat.reader_id}\n`;
          log.innerText += `- –°—Ç–∞—Ç—É—Å: ${chat.status}\n`;
          log.innerText += `- –ß–∞—Å: ${chat.created_at}\n\n`;
        } else {
          log.innerText += `üì© –Ü–Ω—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: ${JSON.stringify(data)}\n`;
        }
      };

      ws.onclose = function () {
        alert("üîå –ó'—î–¥–Ω–∞–Ω–Ω—è –∑–∞–∫—Ä–∏—Ç–æ.");
      };
    }
  </script>
</body>
</html>
